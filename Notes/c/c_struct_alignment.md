# ğŸ“˜ C/C++ Structure èˆ‡ Union å°é½Šèˆ‡ Padding ç­†è¨˜

## âœ… çµæ§‹é«”å°é½Šçš„åŸºæœ¬åŸå‰‡

1. **æ¯å€‹æˆå“¡è®Šæ•¸çš„èµ·å§‹ä½å€**ï¼Œå¿…é ˆæ˜¯å…¶å°é½Šéœ€æ±‚ï¼ˆalignmentï¼‰çš„å€æ•¸ã€‚
2. **æˆå“¡ä¹‹é–“å¦‚æœä¸å°é½Š**ï¼Œç·¨è­¯å™¨æœƒè‡ªå‹•æ’å…¥ paddingï¼ˆå¡«è£œç©ºé–“ï¼‰ä¾†å°é½Šä¸‹ä¸€å€‹æˆå“¡ã€‚
3. **çµæ§‹é«”ç¸½å¤§å°** å¿…é ˆæ˜¯ **æœ€å¤§å°é½Šéœ€æ±‚æˆå“¡çš„å€æ•¸**ï¼Œå¯èƒ½éœ€è¦å°¾éƒ¨ paddingã€‚

---

## ğŸ“Œ ç¯„ä¾‹ï¼š`struct B`

```cpp
struct B {
    char a;   // 1 byte
    int b;    // 4 bytes
    short c;  // 2 bytes
    long d;   // 8 bytes (on 64-bit system)
};
```

---

## ğŸ“Š åˆ†æè¡¨æ ¼

| æˆå“¡      | å¤§å° | å°é½Šéœ€æ±‚ | æ”¾ç½®ä½å€ç¯„åœ | Padding åŸå›                        | Padding å¤§å° |
|-----------|------|-----------|---------------|------------------------------------|--------------|
| `char a`  | 1 B  | 1 B       | 0             | ç‚ºäº†å°é½Š `int b`ï¼ˆéœ€è¦ 4 bytesï¼‰    | 3 B          |
| `int b`   | 4 B  | 4 B       | 4â€“7           | å·²å°é½Š                              | 0 B          |
| `short c` | 2 B  | 2 B       | 8â€“9           | ç‚ºäº†å°é½Š `long d`ï¼ˆéœ€è¦ 8 bytesï¼‰   | 6 B          |
| `long d`  | 8 B  | 8 B       | 16â€“23         | å·²å°é½Š                              | 0 B          |

âœ… **çµæ§‹é«”ç¸½å¤§å°ï¼š24 bytes**  
âœ… **æœ€å¤§å°é½Šéœ€æ±‚ï¼š8 bytes (`long`)**

---

## ğŸ§  ç‚ºä»€éº¼ `short c` å¾Œé¢æœƒåŠ  6 bytes paddingï¼Ÿ

å› ç‚º `long d` éœ€è¦å°é½Šåˆ° 8-byte é‚Šç•Œï¼Œ`c` çµæŸå¾Œ offset æ˜¯ 10ï¼Œ**ä¸æ˜¯ 8 çš„å€æ•¸**ï¼Œæ‰€ä»¥è£œä¸Š 6 bytesï¼Œä½¿ `d` å¾ offset 16 é–‹å§‹ã€‚

---

## â— å¸¸è¦‹èª¤è§£ä¿®æ­£

| èª¤è§£                                                       | æ­£è§£                                                               |
|------------------------------------------------------------|--------------------------------------------------------------------|
| æ¯å€‹æˆå“¡å¾Œçš„ padding éƒ½è£œåˆ° 4 bytes                         | âŒ éŒ¯ï¼Œ**è£œå¤šå°‘ padding æ˜¯æ ¹æ“šä¸‹ä¸€å€‹æˆå“¡çš„å°é½Šéœ€æ±‚**                   |
| çµæ§‹é«”ç¸½å¤§å°æ˜¯æ‰€æœ‰æˆå“¡å¤§å°ç¸½å’Œ                             | âŒ éŒ¯ï¼Œé‚„è¦åŠ ä¸Š**padding** å’Œ **å°¾éƒ¨å°é½Š**                              |
| padding æ˜¯ç‚ºäº†ç•¶å‰æˆå“¡çš„ alignment                          | âŒ éŒ¯ï¼Œpadding æ˜¯ç‚ºäº†**ä¸‹ä¸€å€‹æˆå“¡** çš„ alignment                        |

---

## ğŸ§ª é©—è­‰æ–¹å¼ï¼ˆä½¿ç”¨ C++ï¼‰

```cpp
#include <iostream>
#include <cstddef>

struct B {
    char a;
    int b;
    short c;
    long d;
};

int main() {
    std::cout << "sizeof(B) = " << sizeof(B) << "\n";
    std::cout << "offsetof(a) = " << offsetof(B, a) << "\n";
    std::cout << "offsetof(b) = " << offsetof(B, b) << "\n";
    std::cout << "offsetof(c) = " << offsetof(B, c) << "\n";
    std::cout << "offsetof(d) = " << offsetof(B, d) << "\n";
}
```

---

## ğŸ“ å°çµ

- ğŸ”„ **padding æ˜¯ç‚ºäº†è®“ä¸‹ä¸€å€‹æˆå“¡å°é½Šï¼Œè€Œéè‡ªå·±**
- ğŸ“ çµæ§‹é«”çš„ç¸½å¤§å°ï¼Œæœƒå‘ä¸Šè£œåˆ°æœ€å¤§å°é½Šéœ€æ±‚çš„å€æ•¸
- âš  éåº¦ä½¿ç”¨ padding å¯èƒ½æµªè²»ç©ºé–“ï¼Œå¯é€é **èª¿æ•´æˆå“¡é †åº** æˆ– `#pragma pack` å„ªåŒ–

## âœ… Union çš„åŸºæœ¬åŸå‰‡

- union çš„æ‰€æœ‰æˆå“¡å…±ç”¨åŒä¸€å¡Šè¨˜æ†¶é«”ã€‚
- union çš„å¤§å° è‡³å°‘ç­‰æ–¼ æœ€å¤§æˆå“¡çš„å¤§å°ã€‚
- ç·¨è­¯å™¨æœƒæ ¹æ“š æœ€åš´æ ¼çš„å°é½Šéœ€æ±‚æˆå“¡ï¼Œå¯èƒ½é¡å¤–æ’å…¥ paddingã€‚
- ä½¿ç”¨ sizeof(unionName) å¯ç›´æ¥å¾—åˆ° union çš„å¯¦éš›å¤§å°ã€‚

## ğŸ“Œ ç¯„ä¾‹ï¼šunion Data
```cpp
#include <stdio.h>

union Data {
    char c;      // 1 byte
    int i;       // é€šå¸¸ 4 bytes
    double d;    // é€šå¸¸ 8 bytes
};

int main() {
    printf("Size of union: %zu\n", sizeof(union Data));
    printf("Size of char:  %zu\n", sizeof(char));
    printf("Size of int:   %zu\n", sizeof(int));
    printf("Size of double:%zu\n", sizeof(double));
}
```

## ğŸ“Š åˆ†æ

``` bash
char = 1 byte
int = 4 bytes
double = 8 bytes
æœ€å¤§æˆå“¡ = double (8 bytes)
union å¤§å° = 8 bytesï¼ˆå¯èƒ½æ›´å¤šï¼Œå¦‚æœå°é½Šéœ€æ±‚æ›´å¤§ï¼‰
```

## â— Union å¸¸è¦‹èª¤è§£

|èª¤è§£  |  æ­£è§£  |
| ----- | ----- |
| union çš„å¤§å°ç­‰æ–¼æ‰€æœ‰æˆå“¡å¤§å°çš„ç¸½å’Œ | âŒ éŒ¯ï¼Œunion çš„å¤§å°åªå– æœ€å¤§æˆå“¡å¤§å° + alignment padding|
|æ¯å€‹æˆå“¡ç¨ç«‹å­˜åœ¨æ–¼è¨˜æ†¶é«”ä¸­| âŒ éŒ¯ï¼Œæ‰€æœ‰æˆå“¡å…±ç”¨åŒä¸€å¡Šè¨˜æ†¶é«”ï¼Œå¯«å…¥ä¸€å€‹æœƒè¦†è“‹å¦ä¸€å€‹

## ğŸ“ å°çµ

- structï¼šæˆå“¡ ç¨ç«‹å­˜æ”¾ï¼Œç¸½å¤§å° = å„æˆå“¡å¤§å° + padding + å°¾éƒ¨å°é½Šã€‚
- unionï¼šæˆå“¡ å…±ç”¨è¨˜æ†¶é«”ï¼Œå¤§å° = æœ€å¤§æˆå“¡å¤§å°ï¼ˆå« alignment paddingï¼‰ã€‚
